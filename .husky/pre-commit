#!/bin/sh
. "$(dirname "$0")/_/husky.sh" 2>/dev/null || true

set +e

echo "ğŸ§¹ [husky] Auto-fix ESLint + Prettier (commit non bloquÃ©)..."

# RÃ©cupÃ¨re les fichiers modifiÃ©s mis en staging
FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(js|jsx|ts|tsx|json|md|css|scss)$')

if [ -n "$FILES" ]; then
  echo "ğŸ”§ Fichiers dÃ©tectÃ©s :"
  echo "$FILES"

  if command -v yarn >/dev/null 2>&1; then
    echo "ğŸ‘‰ Fix avec yarn..."
    echo "$FILES" | xargs yarn eslint --fix
    echo "$FILES" | xargs yarn prettier --write
  elif command -v npx >/dev/null 2>&1; then
    echo "ğŸ‘‰ Fix avec npx..."
    echo "$FILES" | xargs npx eslint --fix
    echo "$FILES" | xargs npx prettier --write
  else
    echo "âš ï¸ Ni yarn ni npx trouvÃ©s â€” skip auto-fix."
  fi

  # RÃ©-ajoute les fichiers corrigÃ©s au commit
  git add $FILES

  echo "âœ… Auto-fix terminÃ© (non bloquant)"
else
  echo "â„¹ï¸ Aucun fichier modifiÃ© pertinent â€” skip ESLint/Prettier."
fi

exit 0
