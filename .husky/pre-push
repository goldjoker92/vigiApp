#!/bin/sh
echo ""
echo "ğŸ” [husky] VÃ©rification (non-bloquante) des dÃ©pendances Expo/Yarn..."

# 1) Check alignement Expo (info only)
CI=1 yarn expo install --check >/dev/null 2>&1
if [ $? -eq 0 ]; then
  echo "ğŸ“¦ Expo deps OK"
else
  echo "âš ï¸ Expo deps possiblement dÃ©salignÃ©es."
  echo "   ğŸ‘‰ Conseils Yarn :"
  echo "      - Aligner Expo :  yarn expo install"
  echo "      - Inspecter pkg : yarn why <package>"
fi

# 2) Dedupe (selon Yarn major)
YARN_VERSION=$(yarn -v 2>/dev/null)
YARN_MAJOR=$(echo "$YARN_VERSION" | cut -d. -f1)

if [ "$YARN_MAJOR" -ge 2 ]; then
  yarn dedupe >/dev/null 2>&1 \
    && echo "ğŸ§¹ yarn dedupe (Berry) OK" \
    || echo "â„¹ï¸ Tips Berry: yarn dedupe && yarn install"
else
  npx --yes yarn-deduplicate yarn.lock >/dev/null 2>&1 \
    && echo "ğŸ§¹ yarn-deduplicate (v1) OK" \
    || echo "â„¹ï¸ Tips v1: npm i -D yarn-deduplicate && npx yarn-deduplicate yarn.lock && yarn install"
fi

echo "âœ… [husky] Non-bloquant. Push autorisÃ©."
exit 0
