#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "[husky] pre-push — cohérence des dépendances (non-bloquant)…"

TMP_DIR="$(node -e "console.log(require('os').tmpdir())")"
OUT_RAW="$TMP_DIR/husky_deps_check.txt"

npx --yes expo install --check --non-interactive >"$OUT_RAW" 2>&1 || true

node scripts/expo-check-to-advice.js < "$OUT_RAW" \
  | node scripts/husky-report-single.js --hook pre-push \
  || echo "[husky] rapport deps partiel (non bloquant)"
